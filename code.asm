INCLUDE Irvine32.inc

.data
map1 BYTE "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",0
     BYTE "@@ .  .  .  .  .  .  .  .  .  @@@ .  .  .  .  .  .  .  .  .   @@",0
     BYTE "@@                            @@@                             @@",0
     BYTE "@@ . .  .  .  .  .  .  .  .  .   .  .   .   .   .   .  .  .   @@",0
     BYTE "@@  @@@@@@@      @@@@  @@@@@@@@@@@@@@@@  @@@@        @@@@@@@  @@",0
     BYTE "@@  @ .          @@@@  @@@@@@@@@@@@@@@@  @@@@          .   @  @@",0
     BYTE "@@  @            @@@@        @@@         @@@@              @  @@",0
     BYTE "@@  @            @@@@@@@@@@  @@@  @@@@@@@@@@@              @  @@",0
     BYTE "@@  @            @@@@@@@@@@  @@@  @@@@@@@@@@@              @  @@",0
     BYTE "@@  @ .    .     .      .    @@@  .    .     .     .       @  @@",0
     BYTE "@@  @  @@@@@                 @@@                 @@@@@@    @  @@",0
     BYTE "@@  @  @@@@@                  .                  @@@@@@    @  @@",0
     BYTE "@@  @    .            @@@@@@@@   @@@@@@@               .   @  @@",0
     BYTE "@@  @@@@@             @@@@@@@@ . @@@@@@@                @@@@  @@",0
     BYTE "@@@ @@@@@  @@@@@@@@@@@@@ .           .@@@@@@@@@@@@@@@@  @@@@  @@",0
     BYTE "@@.  .  .  .  .    .  @@ .   .   .   .@@ .  .  .  .  . . ..   @@",0
     BYTE "@@  @@@@              @@@@@@@@@@@@@@@@@@                @@@@ @@@",0
     BYTE "@@  @@@@              @@@@@@@@@@@@@@@@@@                @@@@  @@",0
     BYTE "@@  @@@@                                                @@@@  @@",0
     BYTE "@@  @@@@                      @@@                       @@@@  @@",0
     BYTE "@@  @   .    .    .    .      @@@   .     .     .     .    @  @@",0
     BYTE "@@  @             @@@@@@@@@@  @@@  @@@@@@@@@@@             @  @@",0
     BYTE "@@  @             @@@@        @@@         @@@@             @  @@",0
     BYTE "@@  @             @@@@  .   . @@@  .   .  @@@@             @  @@",0
     BYTE "@@  @             @@@@  @@@@@@@@@@@@@@@@  @@@@             @  @@",0
     BYTE "@@  @             @@@@  @@@@@@@@@@@@@@@@  @@@@             @  @@",0
     BYTE "@@  @@@@@@@@@@@@  @@@@  @@@@@@@@@@@@@@@@  @@@@  @@@@@@@@@@@@  @@",0
     BYTE "@@ .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . @@",0
     BYTE "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",0
 

map BYTE "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",0
    BYTE "@@ .  .  .  .  .  .  .  .  .  @@@ .  .  .  .  .  .  .  .  .   @@",0
    BYTE "@@  @@@@@@@  @@@@@@@@@        @@@         @@@@@@@@@  @@@@@@@  @@",0
    BYTE "@@ . .  .  .  .  .  .  .  .  .   .  .   .   .   .   .  .  .   @@",0
    BYTE "@@  @@@@@@@  @@@  @@@@  @@@@@@@@@@@@@@@@  @@@@  @@@  @@@@@@@  @@",0
    BYTE "@@  @@ .          @@@@  @@@@@@@@@@@@@@@@  @@@@          . @@  @@",0
    BYTE "@@  @@  @@@@@@@@  @@@@        @@@         @@@@  @@@@@@@@  @@  @@",0
    BYTE "@@  @@  @@@@@@@@  @@@@@@@@@@  @@@  @@@@@@@@@@@  @@@@@@@@  @@  @@",0
    BYTE "@@  @@  @@@@@@@@  @@@@@@@@@@  @@@  @@@@@@@@@@@  @@@@@@@@  @@  @@",0
    BYTE "@@  @@ .    .     .      .    @@@  .    .     .     .     @@  @@",0
    BYTE "@@  @@  @@@@@  @@@@@@@@@@@@@  @@@  @@@@@@@@@@@@  @@@@@@@  @@  @@",0
    BYTE "@@  @@  @@@@@                  .                 @@@@@@@  @@  @@",0
    BYTE "@@  @@    .    @@@@@  @@@@@@@@   @@@@@@@  @@@@@        .  @@  @@",0
    BYTE "@@  @@@@@  @@@@@@@@@  @@@@@@@@ . @@@@@@@  @@@@@@@@@@@@  @@@@  @@",0
    BYTE "@@@ @@@@@  @@@@@@@@@ @@@ .           .@@  @@@@@@@@@@@@  @@@@  @@",0
    BYTE "@@ .  .  .  .  .    . @@ .   .   .   .@@ .  .  .  .  . . ..   @@",0
    BYTE "@@  @@@@@  @@@@@@@@@  @@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@  @@@@@ @@@",0
    BYTE "@@  @@@@@  @@@@@@@@@  @@@@@@@@@@@@@@@@@@  @@@@@@@@@@@  @@@@@  @@",0
    BYTE "@@  @@@@@  @@@@@@@@@                      @@@@@@@@@@@  @@@@@  @@",0
    BYTE "@@  @@@@@  @@@@@@@@@@@@@@@@@  @@@  @@@@@@@@@@@@@@@@@@  @@@@@  @@",0
    BYTE "@@  @@  .    .    .    .      @@@   .     .     .     .   @@  @@",0
    BYTE "@@  @@  @@@@@@@@  @@@@@@@@@@  @@@  @@@@@@@@@@@  @@@@@@@@  @@  @@",0
    BYTE "@@  @@  @@@@@@@@  @@@@        @@@         @@@@  @@@@@@@@  @@  @@",0
    BYTE "@@  @@  @@@@@@@@  @@@@  .   . @@@  .   .  @@@@  @@@@@@@@  @@  @@",0
    BYTE "@@  @@            @@@@  @@@@@@@@@@@@@@@@  @@@@            @@  @@",0
    BYTE "@@  @@@@@@  @@@@  @@@@  @@@@@@@@@@@@@@@@  @@@@  @@@@@@@@@@@@  @@",0
    BYTE "@@  @@@@@@  @@@@  @@@@  @@@@@@@@@@@@@@@@  @@@@  @@@@@@@@@@@@  @@",0
    BYTE "@@ .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . @@",0
    BYTE "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",0

    MapAnimation BYTE "*********************************************************",0

    strScore BYTE "SCORE : ",0

    score BYTE 0

    xPos BYTE 30
    yPos BYTE 15

    inputChar BYTE ? 

    temp BYTE 0


    strLives BYTE "LIVES : ",0
    lives BYTE 3

    strLevel BYTE "LEVEL : ",0
    Level BYTE 1

    activeMapPtr DWORD ?


InstuctStr             BYTE "                                                      ",0ah 
                       BYTE "  /=================================================\\",0ah
                       BYTE "  |               GAME INSTRUCTIONS                  |",0ah
                       BYTE "  |==================================================|",0ah
                       BYTE "  |                                                  |",0ah
                       BYTE "  |  CONTROLS:                                       |",0ah
                       BYTE "  |  * Move Pac-Man with [W][A][S][D] keys:          |",0ah
                       BYTE "  |    - W - Move Up                                 |",0ah
                       BYTE "  |    - A - Move Left                               |",0ah
                       BYTE "  |    - S - Move Down                               |",0ah
                       BYTE "  |    - D - Move Right                              |",0ah
                       BYTE "  |                                                  |",0ah
                       BYTE "  |  GAMEPLAY:                                       |",0ah
                       BYTE "  |  * Collect all pellets to complete each level    |",0ah
                       BYTE "  |  * Avoid the ghosts or lose a life               |",0ah
                       BYTE "  |  * Each pellet earns you points                  |",0ah
                       BYTE "  |  * Special power pellets let you eat ghosts      |",0ah
                       BYTE "  |                                                  |",0ah 
                       BYTE "  |  OTHER:                                          |",0ah
                       BYTE "  |  * Press [P] to pause/resume the game            |",0ah
                       BYTE "  |  * Press [ESC] to quit                           |",0ah
                       BYTE "  |                                                  |",0ah
                       BYTE "  |==================================================|",0ah
                       BYTE "  |            PRESS ANY KEY TO START                |",0ah
                       BYTE "  \\=================================================/",0ah,0

 
    
            
PacmanStr   BYTE "           _____   ___   _____   __  __   ___   _   _ ", 0Ah
            BYTE "          |  __ \ / _ \ /  __ \ |  \/  | / _ \ | \ | |", 0Ah
            BYTE "          | |__) / /_\ \  /  \/ | .  . |/ /_\ \|  \| |", 0Ah
            BYTE "          |  ___/|  _  |  |     | |\/| ||  _  || . ` |", 0Ah
            BYTE "          | |    | | | |  \__/\ | |  | || | | || |\  |", 0Ah
            BYTE "          |_|    \_| |_/\______|\_|  |_/\_| |_/\_| \_/", 0Ah, 0


        
        playerNameBuffer   byte 30 dup(?)
        playerNameLength   dword ?
        NamePrompt BYTE "Enter Username: ",0

MenuStr BYTE "                                                      ",0ah
        BYTE "  /=================================================\\",0ah
        BYTE "  |                   MAIN MENU                      |",0ah
        BYTE "  |==================================================|",0ah
        BYTE "  |                                                  |",0ah
        BYTE "  |          [1] START NEW GAME                      |",0ah
        BYTE "  |                                                  |",0ah
        BYTE "  |          [2] HIGH SCORES                         |",0ah
        BYTE "  |                                                  |",0ah
        BYTE "  |          [3] SELECT DIFFICULTY                   |",0ah
        BYTE "  |                                                  |",0ah
        BYTE "  |          [4] QUIT GAME                           |",0ah
        BYTE "  |              (Don't fear the ghosts!)            |",0ah
        BYTE "  |                                                  |",0ah
        BYTE "  |==================================================|",0ah
        BYTE "  |          ENTER YOUR CHOICE (1-4):                |",0ah
        BYTE "  |          _                                       |",0ah
        BYTE "  \\=================================================/",0ah,0

                                              
levelOptns BYTE "  /=================================================\\",0ah
           BYTE "  |               LEVEL SELECTION                   |",0ah
           BYTE "  |=================================================|",0ah
           BYTE "  |                                                  |",0ah
           BYTE "  |          [1] LEVEL 1 - BEGINNER                  |",0ah
           BYTE "  |              .-. .-. .-.                         |",0ah
           BYTE "  |              |o| |o| |o|                         |",0ah
           BYTE "  |                                                  |",0ah
           BYTE "  |          [2] LEVEL 2 - INTERMEDIATE              |",0ah
           BYTE "  |              .-. .-. .-. .-.                     |",0ah
           BYTE "  |              |o| |o| |o| |o|                     |",0ah
           BYTE "  |                                                  |",0ah
           BYTE "  |          [3] LEVEL 3 - ADVANCED                  |",0ah
           BYTE "  |              .-. .-. .-. .-. .-.                 |",0ah
           BYTE "  |              |o| |o| |o| |o| |o|                 |",0ah
           BYTE "  |                                                  |",0ah
           BYTE "  |=================================================|",0ah
           BYTE "  |          ENTER YOUR CHOICE (1-3):                |",0ah
           BYTE "  |          _                                       |",0ah
           BYTE "  \\=================================================/",0ah,0


FileName byte "scores.txt",0
ScoresBuffer BYTE 1024 DUP(?)
tempScoreBuffer BYTE 100 DUP(?)
CurrentFileHandle DWORD ?
scoreHeader BYTE "High Scores:",0ah,0

fileOpenError BYTE "Error opening file.",0
fileCreateError BYTE "Error creating file.",0
fileReadError BYTE "Error reading file.",0
fileWriteError BYTE "Error writing to file.",0

highScoreStr BYTE "TOP SCORES",0
highScoreHeader BYTE "  /=================================================\\",0ah
               BYTE "  |                  HIGH SCORES                    |",0ah
               BYTE "  |=================================================|",0ah,0
highScoreFooter BYTE "  |=================================================|",0ah
               BYTE "  |          PRESS ANY KEY TO RETURN                |",0ah
               BYTE "  \\=================================================/",0ah,0

Enemy1 BYTE 25,4
EnemyDirection BYTE 1

Enemy2 BYTE 30,4
Enemy2Direction BYTE 2

Enemy3 BYTE 35,20
Enemy3Direction BYTE 1

xFruitPos BYTE 13
yFruitPos BYTE 6



gameOver BYTE "                                                      ",0ah
         BYTE "  /=================================================\\",0ah
         BYTE "  |                                                  |",0ah
         BYTE "  |                                                  |",0ah
         BYTE "  |     #####    #    #    #   #####                 |",0ah
         BYTE "  |    #        # #   ##  ##   #                     |",0ah
         BYTE "  |    #  ###  #####  # ## #   #####                 |",0ah
         BYTE "  |    #    #  #   #  #    #   #                     |",0ah
         BYTE "  |     #####  #   #  #    #   #####                 |",0ah
         BYTE "  |                                                  |",0ah
         BYTE "  |     ####   #       #   #####   ####              |",0ah
         BYTE "  |    #    #  #       #   #      #    #             |",0ah
         BYTE "  |    #    #   #     #    #####  ######             |",0ah
         BYTE "  |    #    #    #   #     #      #   #              |",0ah
         BYTE "  |     ####      ###      #####  #    #             |",0ah
         BYTE "  |                                                  |",0ah
         BYTE "  |          BETTER LUCK NEXT TIME!                  |",0ah
         BYTE "  |                                                  |",0ah
         BYTE "  |          GHOSTS: 1  -  PAC-MAN: 0                |",0ah
         BYTE "  |                                                  |",0ah
         BYTE "  |          PRESS ANY KEY TO CONTINUE...            |",0ah
         BYTE "  |                                                  |",0ah
         BYTE "  \\=================================================/",0ah,0


Portal_From_X BYTE 3
Portal_From_Y BYTE 16

Portal_To_X BYTE 61
Portal_To_Y BYTE 16


.code
main PROC
;Game Name
    mov dl,0
    mov dh,8
    call Gotoxy
    mov edx,OFFSET PacmanStr
    mov eax,brown
    call SetTextColor
    call WriteString
   

;Prompt + Take Name Input   
    mov dl,15
    mov dh,15
    call Gotoxy
    mov edx,OFFSET NamePrompt
    call WriteString
    mov edx,offset PlayerNameBuffer
    mov ecx,lengthof playerNameBuffer
    call readstring
    mov playerNameLength, eax ; Store the length of the player name
    call clrscr



;instructions
    mov dl,10
    mov dh,5
    call Gotoxy
    mov edx,OFFSET InstuctStr
    call WriteString
    call readchar


BackToMenu:
;Menu Display
    mov eax,0
    call clrscr
    mov dl,0
    mov dh,7
    call Gotoxy
    mov edx,OFFSET MenuStr
    call WriteString
    call readint
       

;MENU ACTIONS
MENU:
   
    cmp al,1
    je skip
    cmp al,2
    je ShowHighScores
    cmp al,3
    jne keepChecking
    call clrscr
    mov dl,0
    mov dh,7
    call Gotoxy
    mov edx,OFFSET levelOptns
    call WriteString
    call readint
    mov level,al
    jmp skip
    

    keepChecking:
    cmp al,4
    je exitGame
    jmp BackToMenu

ShowHighScores:
    jmp BackToMenu

NextLevel:
    call printcoins
    inc level
    skip:
    mov lives,3
    mov xpos,30
    mov ypos,15
    mov score,0
    mov Enemy1,25
    mov Enemy1+1,4
    mov Enemy2,30
    mov Enemy2+1,4
    mov Enemy3,35
    mov Enemy3+1,20

    call Animation
    cmp level,2  
    jl UseMap1
    call DrawMap      ; Level 2+ uses map
    jmp MapDrawDone
    UseMap1:
    call DrawMap1     ; Level 1 uses map1
    MapDrawDone:

    call DrawPlayer
    call DrawEnemy

    cmp level,2
    jl NotLevel2
    call DrawEnemy2
    call DrawEnemy3
    call DrawFruit
    NotLevel2:

    cmp level,1
    jne UseMap2
    mov eax,offset map1
    mov activeMapPtr,eax
    jmp MapPtrSet
UseMap2:
    mov eax,offset map
    mov activeMapPtr,eax
MapPtrSet:

    gameLoop:
            
            cmp level,4
            je exitgame

            cmp score,100
            je NextLevel

            cmp lives,0
            je exitgame

            ;collison
            mov esi,offset Enemy1
            mov al,[esi]
            cmp al,xpos
            jne NoCollide
            mov al,[esi+1]
            cmp al,ypos
            jne NoCollide
            ;collide:
                dec lives           
                
                mov xPos,30
                mov yPos,15

            NoCollide:

            cmp level,2
            jl dontCheckCollison2
            mov esi,offset Enemy2
            mov al,[esi]
            cmp al,xpos
            jne NoCollide2
            mov al,[esi+1]
            cmp al,ypos
            jne NoCollide2
            ;collide:
                dec lives           
              
                mov xPos,30
                mov yPos,15
            NoCollide2:

            cmp level,3
            jl dontMoveE3
            call DrawEnemy3
            call MoveEnemy3
            dontMoveE3:

            dontCheckCollison2:

        call MoveEnemy
        mov eax,60
        cmp level,2
        jl setDelay
        mov eax,40
        cmp level,3
        jl setDelay
        mov eax,25
setDelay:
        call delay
        

        cmp level,2
        jl dontMoveE2
        call DrawEnemy2
        call MoveEnemy2
        dontMoveE2:

         ; FRUIT
         cmp level,1
         je Coin_collection
            mov bl,xPos
            cmp bl,xFruitPos
            jne notCollect
            mov bl,yPos
            cmp bl,yFruitPos
            jne notCollect
;           player is intersecting Fruit:
            add score,10
            call CreateRandomFruit
            call DrawFruit
            notCollect:

Coin_collection:
    mov eax,0
    mov ecx,0 
    mov ebx,0
    mov eax,65 
    movzx ecx,ypos
    sub ecx,1
    imul eax,ecx
    mov bl,xpos
    add eax,ebx
    mov esi,eax
    
    cmp level,1
    jne CheckMap2
    cmp map1[esi],'.'
    jne notCollecting
    inc score
    mov map1[esi],'&'
    mov eax,800      ; frequency in Hz
    mov ebx,50       ; duration in ms
    jmp notCollecting
    
CheckMap2:
    mov eax,activeMapPtr
    cmp byte ptr [eax+esi],'.'
    jne notCollecting
    inc score
    mov byte ptr [eax+esi],'&'
    mov eax,800      ; frequency in Hz
    mov ebx,50       ; duration in ms
notCollecting:
    mov eax,white (black * 16)
    call SetTextColor

        ; draw level:
        mov dl,27
        mov dh,0
        call Gotoxy
        mov edx,OFFSET strLevel
        call WriteString 
        mov al,Level
        call WriteDec

        ; draw score:
        mov dl,0
        mov dh,0
        call Gotoxy
        mov edx,OFFSET strScore
        call WriteString
        mov al,score
        call WriteDec

         ; draw LIVES:
        mov dl,55
        mov dh,0
        call Gotoxy
        mov edx,OFFSET strLives 
        call WriteString
        mov al,lives
        call WriteDec

        ;;;;;;;;;;;;;;;;;
         ;collision
            mov esi,offset Enemy1
            mov al,[esi]
            cmp al,xpos
            jne NoCollide3
            mov al,[esi+1]
            cmp al,ypos
            jne NoCollide3
            ;collide:
                dec lives           
                mov xPos,30
                mov yPos,15

            NoCollide3:

            cmp level,2
            jl dontCheckCollison3
            mov esi,offset Enemy2
            mov al,[esi]
            cmp al,xpos
            jne NoCollide4
            mov al,[esi+1]
            cmp al,ypos
            jne NoCollide4
            ;collide:
                dec lives           
                
                mov xPos,30
                mov yPos,15
            NoCollide4:

            cmp level,3
            jl dontCheckCollisonE3
            mov esi,offset Enemy3
            mov al,[esi]
            cmp al,xpos
            jne NoCollideE3
            mov al,[esi+1]
            cmp al,ypos
            jne NoCollideE3
            ;collide:
                dec lives          
                mov xPos,30
                mov yPos,15
            NoCollideE3:

            dontCheckCollison3:
            dontCheckCollisonE3:

            cmp level,3
            jl noPortal
            mov al,Portal_From_X
            cmp al,xpos
            jne NoMatch
            mov al,Portal_From_Y
            cmp al,ypos
            jne NoMatch
                call UpdatePlayer
                mov al,Portal_To_X
                mov xPos,al
                mov al,Portal_To_Y
                mov yPos,al
            NoMatch:
            noPortal:


         ; get user key input:
        call Readkey
        ;call Readchar

        cmp al,1
        je previousInput
        mov inputChar,al

        previousInput:

        ; exit game if user types 'x':
        cmp inputChar,"x"
        je exitGame

        cmp inputChar,"w"
        je moveUp

        cmp inputChar,"s"
        je moveDown

        cmp inputChar,"a"
        je moveLeft

        cmp inputChar,"d"
        je moveRight

        cmp inputChar,"p"
        je pauseLoop






jmp gameloop

        pauseLoop:
            call Readchar
            cmp al,"r"
        jne pauseLoop
        mov inputChar,0
        jmp gameloop




        


        ;;;;;;;;;;;;MOVEMENT;;;;;;;;;;


        moveUp:
            call UpdatePlayer
            dec yPos
            movzx eax,xpos
            movzx ebx,ypos
            call MapChar
            cmp al,'@'
	        jne reset1
	        inc yPos
	        reset1:
            call DrawPlayer
            jmp gameLoop

        moveDown:
            call UpdatePlayer
            inc yPos
            movzx eax,xpos
            movzx ebx,ypos
            call MapChar
            cmp al,'@'
	        jne reset2
	        dec yPos
	        reset2:
            call DrawPlayer
            jmp gameLoop
            
        moveLeft:
            call UpdatePlayer
            dec xPos
            movzx eax,xpos
            movzx ebx,ypos
            call MapChar
            cmp al,'@'
	        jne reset3
	        inc xPos
	        reset3:
            call DrawPlayer
            jmp gameLoop

        moveRight:
            call UpdatePlayer
            inc xPos
            movzx eax,xpos
            movzx ebx,ypos
            call MapChar
            cmp al,'@'
	        jne reset4
	        dec xPos
	        reset4: 
            call DrawPlayer

           



    jmp gameLoop

        ; LEVEL END SCREEN ,SCORE ETX , NEXT LEVEL 

    exitGame:
        ; Save the score before exiting
        call SavePlayerScore
        
        mov eax,white
        call SetTextColor
        call clrscr
        mov dl,25
        mov dh,15
        call Gotoxy
        mov edx,OFFSET gameOver
        mov eax,brown
        call SetTextColor
        call WriteString

        ; Display current user's name and score
        mov dl,25
        mov dh,18
        call Gotoxy
        mov edx,OFFSET playerNameBuffer
        call WriteString
        mov edx,OFFSET strScore
        call WriteString
        movzx eax,score
        call WriteDec
        mov edx,OFFSET strLevel
        call WriteString
        movzx eax,level
        call WriteDec

        mov dl,25
        mov dh,22
        call Gotoxy
        mov edx,OFFSET waitMsg
        call WriteString
        
        call ReadChar

        exit
main ENDP

DrawMap1 PROC
    mov dl,0
    mov dh,1
    mov bl,dh
    mov ecx,29

    mov esi,offset map1
    A: 
        mov eax,blue;(black * 16)
        call SetTextColor
        mov dh,bl
        mov dl,0
        call Gotoxy
        mov edx,esi
        call WriteString ;top
        call Delay
        call Delay
        add esi, 65
        inc bl
    loop A
    ret
DrawMap1 ENDP

DrawMap PROC
    mov dl,0
    mov dh,1
    mov bl,dh
    mov ecx,29

    mov esi,offset map
    A: 
        mov eax,blue;(black * 16)
        call SetTextColor
        mov dh,bl
        mov dl,0
        call Gotoxy
        mov edx,esi
        call WriteString ;top
        call Delay
        call Delay
        add esi, 65
        inc bl
    loop A
    ret
DrawMap ENDP

DrawPlayer PROC
    ; draw player at (xPos,yPos):
    mov eax,brown(brown*16)
    call SetTextColor
    mov dl,xPos
    mov dh,yPos
    call Gotoxy
    mov al,"G"
    call WriteChar
    ret
DrawPlayer ENDP

UpdatePlayer PROC
    mov dl,xPos
    mov dh,yPos
    call Gotoxy
    mov al," "
    call WriteChar
    ret
UpdatePlayer ENDP

Animation PROC
    mov dl,0
    mov dh,1
    mov bl,dh
    mov ecx,29
    B:
        mov eax,red 
        call SetTextColor
        mov dh,bl
        mov dl,0
        call Gotoxy
        mov edx,offset MapAnimation
        call WriteString 
        inc bl
    loop B
    ret
Animation ENDP

MoveEnemy PROC
    mov esi,offset Enemy1
 ;clearing trail 
    
    ;coin rewrite
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'.'
    jne NoCoin
        mov eax,blue
        call SetTextColor
        mov al,"."
        jmp print
    NoCoin:
        mov eax,0
        call SetTextColor
        mov al," "
    print:
    mov dl,[esi] 
    mov dh,[esi+1]
    call Gotoxy
    call WriteChar  
    jmp skip
    changeDirecton:
    ;random direction
     mov eax,4
     call RandomRange
     ;inc al
     mov EnemyDirection,al
     skip:
        cmp EnemyDirection,1 ;up
        je UP
        cmp EnemyDirection,2 ;down
        je DOWN
        cmp EnemyDirection,3 ;left
        je LEFT
        cmp EnemyDirection,4 ;right
        je RIGHT
   ;movement
RIGHT:
    mov al,1
    add [esi],al ;inc x
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'@'
    jne ok1 
    mov al,1 
    sub [esi],al ;dec x
    jmp changeDirecton
    ok1:
    call DrawEnemy
    jmp return
LEFT:
    mov al,1
    sub [esi],al ;dec x
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'@'
    jne ok2 
    mov al,1
    add [esi],al ;inc x
    jmp changeDirecton
    ok2:
    call DrawEnemy
    jmp return
UP:
    mov al,1
    sub [esi+1],al ;dec y
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'@'
    jne ok3 
    mov al,1
    add [esi+1],al ;inc y
    jmp changeDirecton
    ok3:
    call DrawEnemy
    jmp return
DOWN:
    mov al,1
    add [esi+1],al ;inc y
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'@'
    jne ok4 
    mov al,1
    sub [esi+1],al ;dec y
    jmp changeDirecton
    ok4:
    call DrawEnemy
    jmp return 
return:
ret
MoveEnemy ENDP

DrawEnemy PROC
    ;mov ecx,3
    mov esi, offset Enemy1
    mov edx,0
    mov eax,0
    ;L1:
        mov dl,[esi]
        inc esi
        mov dh,[esi]
        inc esi
        mov eax,red (red * 16)
        call SetTextColor
        call Gotoxy
        mov al,"M"
        call WriteChar
    ;Loop L1
ret
DrawEnemy ENDP

;;;;;;;;;;;;;;;E N E M Y 2

DrawEnemy2 PROC
    ;mov ecx,3
    mov esi, offset Enemy2
    mov edx,0
    mov eax,0
    ;L1:
        mov dl,[esi]
        inc esi
        mov dh,[esi]
        inc esi
        mov eax,red (red * 16)
        call SetTextColor
        call Gotoxy
        mov al,"M"
        call WriteChar
    ;Loop L1
ret
DrawEnemy2 ENDP


MoveEnemy2 PROC
    mov esi,offset Enemy2
 ;clearing trail 
    
    ;coin rewrite
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'.'
    jne NoCoin
        mov eax,blue
        call SetTextColor
        mov al,"."
        jmp print
    NoCoin:
        mov eax,0
        call SetTextColor
        mov al," "
    print:
    mov dl,[esi] 
    mov dh,[esi+1]
    call Gotoxy
    call WriteChar  
    jmp skip
    changeDirecton:
    ;random direction
     mov eax,4
     call RandomRange
     ;inc al
     mov Enemy2Direction,al
     skip:
        cmp Enemy2Direction,1 ;up
        je UP
        cmp Enemy2Direction,2 ;down
        je DOWN
        cmp Enemy2Direction,3 ;left
        je LEFT
        cmp Enemy2Direction,4 ;right
        je RIGHT
   ;movement
RIGHT:
    mov al,1
    add [esi],al ;inc x
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'@'
    jne ok1 
    mov al,1 
    sub [esi],al ;dec x
    jmp changeDirecton
    ok1:
    call DrawEnemy2
    jmp return
LEFT:
    mov al,1
    sub [esi],al ;dec x
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'@'
    jne ok2 
    mov al,1
    add [esi],al ;inc x
    jmp changeDirecton
    ok2:
    call DrawEnemy2
    jmp return
UP:
    mov al,1
    sub [esi+1],al ;dec y
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'@'
    jne ok3 
    mov al,1
    add [esi+1],al ;inc y
    jmp changeDirecton
    ok3:
    call DrawEnemy2
    jmp return
DOWN:
    mov al,1
    add [esi+1],al ;inc y
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'@'
    jne ok4 
    mov al,1
    sub [esi+1],al ;dec y
    jmp changeDirecton
    ok4:
    call DrawEnemy2
    jmp return 
return:
ret
MoveEnemy2 ENDP


MapChar PROC  
    ; eax = x
    ; ebx = y
    mov edi,activeMapPtr
    dec ebx
    imul ebx,65 ;y * width  
    add ebx,eax   ;y + x
    add edi,ebx
    mov al,[edi]
ret
MapChar ENDP



CreateRandomFruit PROC
regen:
    mov eax,27
    call RandomRange 
    inc eax
    mov xFruitPos,al
    mov eax,55
    call RandomRange 
    inc eax
    mov yFruitPos,al
    mov eax,65 
    movzx ebx,yFruitPos
    sub ebx,1
    imul eax,ebx
    mov ebx,0
    mov bl,xFruitPos
    add eax,ebx
    mov esi,eax
    
    cmp level,1
    jne CheckMap2ForFruit
    cmp map1[esi],'@'
    je regen
    ret
    
CheckMap2ForFruit:
    cmp map[esi],'@'
    je regen
    ret
CreateRandomFruit ENDP
      
DrawFruit PROC
    mov eax,red ;(red * 16)
    call SetTextColor
    mov dl,xFruitPos
    mov dh,yFruitPos
    call Gotoxy
    mov al,"*"
    call WriteChar
    ret
DrawFruit ENDP

printcoins Proc
    mov ebx,65
    mov eax,28
    imul eax,ebx
    mov ecx,eax
    dec ecx
    mov edi,0
    
    cmp level,1
    jne ResetMap2
ResetMap1:
    cmp map1[edi],"&"
    jne skipping1
    mov map1[edi],"."
skipping1:
    inc edi
    loop ResetMap1
    ret
    
ResetMap2:
    cmp map[edi],"&"
    jne skipping2
    mov map[edi],"."
skipping2:
    inc edi
    loop ResetMap2
    ret
printcoins endp

DrawEnemy3 PROC
    mov esi, offset Enemy3
    mov edx,0
    mov eax,0
    mov dl,[esi]
    inc esi
    mov dh,[esi]
    inc esi
    mov eax,red (red * 16)
    call SetTextColor
    call Gotoxy
    mov al,"M"
    call WriteChar
    ret
DrawEnemy3 ENDP

MoveEnemy3 PROC
    mov esi,offset Enemy3
    ;clearing trail 
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'.'
    jne NoCoinE3
        mov eax,blue
        call SetTextColor
        mov al,"."
        jmp printE3
    NoCoinE3:
        mov eax,0
        call SetTextColor
        mov al," "
    printE3:
    mov dl,[esi] 
    mov dh,[esi+1]
    call Gotoxy
    call WriteChar  
    jmp skipE3
    changeDirectonE3:
     mov eax,4
     call RandomRange
     mov Enemy3Direction,al
     skipE3:
        cmp Enemy3Direction,1 ;up
        je UPE3
        cmp Enemy3Direction,2 ;down
        je DOWNE3
        cmp Enemy3Direction,3 ;left
        je LEFTE3
        cmp Enemy3Direction,4 ;right
        je RIGHTE3
RIGHTE3:
    mov al,1
    add [esi],al ;inc x
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'@'
    jne ok1E3 
    mov al,1 
    sub [esi],al ;dec x
    jmp changeDirectonE3
    ok1E3:
    call DrawEnemy3
    jmp returnE3
LEFTE3:
    mov al,1
    sub [esi],al ;dec x
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'@'
    jne ok2E3 
    mov al,1
    add [esi],al ;inc x
    jmp changeDirectonE3
    ok2E3:
    call DrawEnemy3
    jmp returnE3
UPE3:
    mov al,1
    sub [esi+1],al ;dec y
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'@'
    jne ok3E3 
    mov al,1
    add [esi+1],al ;inc y
    jmp changeDirectonE3
    ok3E3:
    call DrawEnemy3
    jmp returnE3
DOWNE3:
    mov al,1
    add [esi+1],al ;inc y
    mov eax,0
    mov ebx,0
    mov al,[esi]
    mov bl,[esi+1]
    call MapChar
    cmp al,'@'
    jne ok4E3 
    mov al,1
    sub [esi+1],al ;dec y
    jmp changeDirectonE3
    ok4E3:
    call DrawEnemy3
    jmp returnE3 
returnE3:
ret
MoveEnemy3 ENDP

SavePlayerScore PROC
    ret
SavePlayerScore ENDP

ShowHighScores PROC
    ret
ShowHighScores ENDP

END main